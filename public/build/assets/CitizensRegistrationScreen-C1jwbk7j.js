import{W as K,r as l,j as s,Y as B,y as U}from"./app-CJboC19z.js";import"./index.es-CVkJTfh4.js";import{r as u}from"./index-BBVTLsOf.js";import{S as o}from"./react-select.esm-CrOI7TDd.js";import W from"./Navbar-yBXqrs2a.js";import{F as Y}from"./Footer-BKk4lgld.js";import{L as G,y as n}from"./index-D4oLDdyE.js";function ae({districts:D,the_user:c}){console.log(c);const{data:t,setData:r,post:X,reset:L,errors:i}=K({name:"",nin:"",phone:"",district:"",county:"",subcounty:"",parish:"",village:"",user:(c==null?void 0:c.id)||null}),[k,d]=l.useState([]),[m,g]=l.useState(!1),[h,x]=l.useState(!1),[b,v]=l.useState(!1),[f,y]=l.useState(!1);l.useState(null);const[R,p]=l.useState([]),[A,N]=l.useState([]),[V,j]=l.useState([]),S=D.map(e=>({value:e.id,label:e.district})),C=k.map(e=>({value:e.id,label:e.county})),I=R.map(e=>({value:e.id,label:e.subcounty})),w=A.map(e=>({value:e.id,label:e.parish})),P=V.map(e=>({value:e.id,label:e.village})),E=async e=>{g(!0);try{const a=await axios.get(`/getcounties?district=${e}`);console.log("API Data:",a.data),d(a.data)}catch(a){console.error("Error:",a),d([])}finally{g(!1)}},$=async e=>{x(!0);try{const a=await axios.get(`/getsubcounties?subcounty=${e}`);console.log("API Data:",a.data),p(a.data)}catch(a){console.error("Error:",a),p([])}finally{x(!1)}},q=async e=>{v(!0);try{const a=await axios.get(`/getparishes?parish=${e}`);console.log("API Data:",a.data),N(a.data)}catch(a){console.error("Error:",a),N([])}finally{v(!1)}},O=async e=>{y(!0);try{const a=await axios.get(`/getvillages?village=${e}`);console.log("API Data:",a.data),j(a.data)}catch(a){console.error("Error:",a),j([])}finally{y(!1)}},z=e=>{const a=e.toUpperCase(),Z=/^[A-Z]{2}\d{9}[A-Z0-9]{2}[A-Z]$/;return a.length===14&&Z.test(a)},M=e=>/^07\d{8}$/.test(e),F=async e=>{if(e.preventDefault(),t.district==null)n.error("District is required");else if(t.county==null)n.error("County is required");else if(t.subcounty==null)n.error("Subcounty is required");else if(t.parish==null)n.error("Parish is required");else if(t.village==null)n.error("Village is required");else if(!z(t.nin))n.error("Invalid NIN format. Please enter a valid NIN in the format XX12345678X12X.");else if(!M(t.phone))n.error("Invalid phone number. Enter the format 07XXXXXXXX.");else try{X("/join/post",{preserveScroll:!0,preserveState:!0,onSuccess:()=>{U.visit("/registration-success"),L(),r({})}})}catch(a){console.error("Registration error:",a),n.error("An error occurred while registering the member. Please try again later.")}};return s.jsxs("div",{children:[s.jsx(B,{children:s.jsx("title",{children:"Register Member"})}),s.jsx(W,{}),s.jsxs("section",{className:"max-w-4xl p-6 mx-auto bg-gray-50 rounded-md shadow-md shadow-gray-500 my-10",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("h1",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Register New Kikumi Kikumi Community Member"})}),s.jsx("div",{className:"my-6",children:s.jsxs("form",{onSubmit:F,children:[s.jsx("div",{className:"w-full my-3",children:s.jsx(u.Input,{color:"deep-orange",label:"Full Name",size:"md",value:t.name??"",onChange:e=>r("name",e.target.value),error:i.name})}),s.jsx("div",{className:"w-full my-3",children:s.jsx(u.Input,{color:"deep-orange",label:"National Identification Number (NIN)",size:"md",value:t.nin??"",onChange:e=>r("nin",e.target.value),error:i.nin})}),s.jsx("div",{className:"w-full my-3",children:s.jsx(u.Input,{color:"deep-orange",label:"Contact",size:"md",value:t.phone??"",onChange:e=>r("phone",e.target.value),error:i.phone})}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"District"}),s.jsx(o,{options:S,value:S.find(e=>e.value===t.district),error:i.district,onChange:e=>{r("district",(e==null?void 0:e.value)||""),e&&E(e.value)},placeholder:"Select district...",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"County"}),s.jsx(o,{options:C,value:C.find(e=>e.value===t.county),error:i.county,onChange:e=>{r("county",(e==null?void 0:e.value)||""),e&&$(e.value)},isDisabled:!t.district||m,placeholder:m?"Loading...":"Select county...",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subcounty"}),s.jsx(o,{options:I,value:I.find(e=>e.value===t.subcounty),error:i.subcounty,onChange:e=>{r("subcounty",(e==null?void 0:e.value)||""),e&&q(e.value)},isDisabled:!t.county||h,placeholder:h?"Loading...":"Select subcounty",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Parish"}),s.jsx(o,{options:w,value:w.find(e=>e.value===t.parish),error:i.parish,onChange:e=>{r("parish",(e==null?void 0:e.value)||""),e&&O(e.value)},isDisabled:!t.subcounty||b,placeholder:b?"Loading...":"Select parish",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Village"}),s.jsx(o,{options:P,value:P.find(e=>e.value===t.village),error:i.village,onChange:e=>{r("village",(e==null?void 0:e.value)||"")},isDisabled:!t.parish||f,placeholder:f?"Loading...":"Select village",className:"text-sm"})]}),s.jsx(u.Button,{className:"bg-black mt-3",type:"submit",children:"Register Member"})]})})]}),s.jsx(G,{}),s.jsx(Y,{})]})}export{ae as default};
