import{G,r as i,j as s,S as U,A as H}from"./app-uKz4vlYo.js";import"./index.es-Ccosrw0a.js";import{r as u}from"./index-C9KH4-vc.js";import{S as o}from"./react-select.esm-DLilYk4v.js";import J from"./Navbar-C7yWX1Rg.js";import{F as Q}from"./Footer-zlJN1TN3.js";import{L as T,y as n}from"./index-BQi1tNDd.js";function ie({districts:X,the_user:c,occupations:k}){console.log(c);const{data:t,setData:l,post:A,reset:L,errors:r}=G({name:"",nin:"",phone:"",district:"",county:"",subcounty:"",parish:"",village:"",occupation:"",user:(c==null?void 0:c.id)||null}),[R,d]=i.useState([]),[m,g]=i.useState(!1),[h,x]=i.useState(!1),[b,v]=i.useState(!1),[f,y]=i.useState(!1),[W,Y]=i.useState(null),[O,p]=i.useState([]),[V,N]=i.useState([]),[E,j]=i.useState([]),S=X.map(e=>({value:e.id,label:e.district})),C=R.map(e=>({value:e.id,label:e.county})),I=O.map(e=>({value:e.id,label:e.subcounty})),w=V.map(e=>({value:e.id,label:e.parish})),P=E.map(e=>({value:e.id,label:e.village})),D=k.map(e=>({value:e.id,label:e.occupation})),$=async e=>{g(!0);try{const a=await axios.get(`/getcounties?district=${e}`);console.log("API Data:",a.data),d(a.data)}catch(a){console.error("Error:",a),d([])}finally{g(!1)}},q=async e=>{x(!0);try{const a=await axios.get(`/getsubcounties?subcounty=${e}`);console.log("API Data:",a.data),p(a.data)}catch(a){console.error("Error:",a),p([])}finally{x(!1)}},z=async e=>{v(!0);try{const a=await axios.get(`/getparishes?parish=${e}`);console.log("API Data:",a.data),N(a.data)}catch(a){console.error("Error:",a),N([])}finally{v(!1)}},M=async e=>{y(!0);try{const a=await axios.get(`/getvillages?village=${e}`);console.log("API Data:",a.data),j(a.data)}catch(a){console.error("Error:",a),j([])}finally{y(!1)}},F=e=>{const a=e.toUpperCase(),B=/^[A-Z]{2}[A-Z0-9]{11}[A-Z]$/;return a.length===14&&B.test(a)},Z=e=>/^07\d{8}$/.test(e),K=async e=>{if(e.preventDefault(),t.district==null)n.error("District is required");else if(t.county==null)n.error("County is required");else if(t.subcounty==null)n.error("Subcounty is required");else if(t.parish==null)n.error("Parish is required");else if(t.village==null)n.error("Village is required");else if(!F(t.nin))n.error("Invalid NIN format. Please enter a valid NIN in the format XX12345678X12X.");else if(!Z(t.phone))n.error("Invalid phone number. Enter the format 07XXXXXXXX.");else try{console.log("Submitting data:",t),A("/join/post",{preserveScroll:!0,preserveState:!0,onSuccess:()=>{H.visit("/registration-success"),L(),l({})}})}catch(a){console.error("Registration error:",a),n.error("An error occurred while registering the member. Please try again later.")}};return s.jsxs("div",{children:[s.jsx(U,{children:s.jsx("title",{children:"Register Member"})}),s.jsx(J,{}),s.jsxs("section",{className:"max-w-4xl p-6 mx-auto bg-gray-50 rounded-md shadow-md shadow-gray-500 my-10",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("h1",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Register New Kikumi Kikumi Community Member"})}),s.jsx("div",{className:"my-6",children:s.jsxs("form",{onSubmit:K,children:[s.jsx("div",{className:"w-full my-3",children:s.jsx(u.Input,{color:"deep-orange",label:"Full Name",size:"md",value:t.name??"",onChange:e=>l("name",e.target.value),error:r.name})}),s.jsx("div",{className:"w-full my-3",children:s.jsx(u.Input,{color:"deep-orange",label:"National Identification Number (NIN)",size:"md",value:t.nin??"",onChange:e=>l("nin",e.target.value),error:r.nin})}),s.jsx("div",{className:"w-full my-3",children:s.jsx(u.Input,{color:"deep-orange",label:"Contact",size:"md",value:t.phone??"",onChange:e=>l("phone",e.target.value),error:r.phone})}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Occupation"}),s.jsx(o,{options:D,value:D.find(e=>e.value===t.occupation),error:r.occupation,onChange:e=>{l("occupation",(e==null?void 0:e.value)||"")},placeholder:"Select Occupation...",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"District"}),s.jsx(o,{options:S,value:S.find(e=>e.value===t.district),error:r.district,onChange:e=>{l("district",(e==null?void 0:e.value)||""),e&&$(e.value)},placeholder:"Select district...",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"County"}),s.jsx(o,{options:C,value:C.find(e=>e.value===t.county),error:r.county,onChange:e=>{l("county",(e==null?void 0:e.value)||""),e&&q(e.value)},isDisabled:!t.district||m,placeholder:m?"Loading...":"Select county...",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Subcounty"}),s.jsx(o,{options:I,value:I.find(e=>e.value===t.subcounty),error:r.subcounty,onChange:e=>{l("subcounty",(e==null?void 0:e.value)||""),e&&z(e.value)},isDisabled:!t.county||h,placeholder:h?"Loading...":"Select subcounty",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Parish"}),s.jsx(o,{options:w,value:w.find(e=>e.value===t.parish),error:r.parish,onChange:e=>{l("parish",(e==null?void 0:e.value)||""),e&&M(e.value)},isDisabled:!t.subcounty||b,placeholder:b?"Loading...":"Select parish",className:"text-sm"})]}),s.jsxs("div",{className:"my-3",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Village"}),s.jsx(o,{options:P,value:P.find(e=>e.value===t.village),error:r.village,onChange:e=>{l("village",(e==null?void 0:e.value)||"")},isDisabled:!t.parish||f,placeholder:f?"Loading...":"Select village",className:"text-sm"})]}),s.jsx(u.Button,{className:"bg-black mt-3",type:"submit",children:"Register Member"})]})})]}),s.jsx(T,{}),s.jsx(Q,{})]})}export{ie as default};
